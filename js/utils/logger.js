"use strict";
/**
 * a simple logger utility
 *
 *
 * There are two types of logs ( append and overwrite, default is append)
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.logger = exports._test = exports.perf = exports.logPerf = void 0;
// <reference path="../../lib/node-4.d.ts" />
const debug = require("debug");
const debuglog = debug('logger');
;
var perfs = {};
function logPerf(cons, sString) {
    if (!this || !this.enabled) {
        return;
    }
    var label = 'perf' + this.name;
    cons.log('Perf' + this.name);
    if (this.first === 0) {
        this.first = Date.now();
        this.last = this.first;
    }
    else {
        var t = Date.now();
        cons.log('Perf' + this.name +
            ' delta: ' + String("      " + (t - this.last)).slice(-6)
            + ' total: ' + String("      " + (t - this.first)).slice(-6));
        this.last = t;
    }
    if (this.on[sString]) {
        cons.timeEnd(sString);
        delete this.on[sString];
    }
    else {
        cons.time(sString);
        this.on[sString] = 1;
    }
}
exports.logPerf = logPerf;
function perf(string) {
    perfs[string] = { name: string, last: 0, first: 0, on: {}, enabled: false };
    if (debug('perf' + string).enabled) {
        perfs[string].enabled = true;
    }
    return logPerf.bind(perfs[string], console);
}
exports.perf = perf;
const fs = require("fs");
var loggers = {};
var os = require('os');
function getWritableDir() {
    // return process.env[(process.platform == 'win32') ? 'USERPROFILE' : 'HOME'];
    return os.tmpdir();
}
function setupOnce() {
    var home = getWritableDir();
    try {
        fs.mkdirSync(home + '/' + 'fdevstart');
    }
    catch (e) {
    }
    try {
        fs.mkdirSync(home + '/fdevstart/logs');
    }
    catch (e) {
    }
}
setupOnce();
function getFileName(name) {
    return os.tmpdir() + '/fdevstart/logs/' + name + ".log";
}
exports._test = {
    getFileName: getFileName
};
function logIt(logger, arg) {
    var text;
    if (typeof arg === "string") {
        text = arg;
    }
    else if (arg instanceof Error) {
        text = "Error:" + arg.message + " " + arg.stack;
    }
    if (!text) {
        throw new Error("Illegal argument to log");
    }
    var filename = getFileName(logger.name);
    var d = new Date();
    var n = d.toUTCString() + "\t" + text;
    debuglog('writing log entry to ' + filename + ' ' + n);
    fs.writeFileSync(filename, n, { encoding: 'utf-8', flag: 'a' });
}
function logger(name, flags) {
    if (flags !== 'a' && flags !== '' && flags !== undefined) {
        throw new Error('only a allowed as flags');
    }
    flags = (flags === undefined) ? 'a' : flags;
    if (typeof name !== "string" || !/^[A-Za-z][A-Za-z0-9_]+$/.exec(name)) {
        throw new Error('Logger name must be at least two alphanumeric characters');
    }
    if (!loggers[name]) {
        var alogger = {
            name: name,
            flags: flags
        };
        alogger.logIt = logIt.bind(undefined, alogger);
        // reset the file
        if (flags === '') {
            try {
                fs.unlinkSync(getFileName(name));
            }
            catch (e) {
                debuglog("***ERROR: unable to remove log file " + getFileName(name));
            }
        }
        loggers[name] = alogger;
    }
    if (loggers[name].flags !== flags) {
        throw new Error('FLags mismatch in logger' + name);
    }
    return loggers[name].logIt;
}
exports.logger = logger;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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O0tBQ3pCO0lBQ0QsSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxLQUFLLEtBQUssRUFBRTtRQUNqQyxNQUFNLElBQUksS0FBSyxDQUFDLDBCQUEwQixHQUFHLElBQUksQ0FBQyxDQUFDO0tBQ3BEO0lBQ0QsT0FBTyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDO0FBQzdCLENBQUM7QUE1QkQsd0JBNEJDIiwiZmlsZSI6InV0aWxzL2xvZ2dlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuXG4vKipcbiAqIGEgc2ltcGxlIGxvZ2dlciB1dGlsaXR5XG4gKlxuICpcbiAqIFRoZXJlIGFyZSB0d28gdHlwZXMgb2YgbG9ncyAoIGFwcGVuZCBhbmQgb3ZlcndyaXRlLCBkZWZhdWx0IGlzIGFwcGVuZClcbiAqL1xuXG4vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi9saWIvbm9kZS00LmQudHNcIiAvPlxuXG5pbXBvcnQgKiBhcyBkZWJ1ZyBmcm9tICdkZWJ1Zyc7XG5cbmNvbnN0IGRlYnVnbG9nID0gZGVidWcoJ2xvZ2dlcicpO1xuXG5pbnRlcmZhY2UgSUxvZ2dlciB7XG4gIG5hbWU6IHN0cmluZyxcbiAgZmxhZ3M6IHN0cmluZyxcbiAgbG9nSXQ/OiAoYW55KSA9PiB2b2lkXG59O1xuXG52YXIgcGVyZnMgPSB7fSBhcyB7W2tleSA6IHN0cmluZ10gOiB7IGVuYWJsZWQgOiBib29sZWFuLCBuYW1lIDogc3RyaW5nLCBsYXN0OiBudW1iZXIsIGZpcnN0IDogbnVtYmVyLCBvbiA6IHt9fX07XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2dQZXJmKGNvbnMgOiBhbnksIHNTdHJpbmcgOiBzdHJpbmcpIHtcbiAgaWYoIXRoaXMgfHwgIXRoaXMuZW5hYmxlZCkge1xuICAgIHJldHVybjtcbiAgfVxuICB2YXIgbGFiZWwgPSAncGVyZicgKyB0aGlzLm5hbWU7XG4gIGNvbnMubG9nKCdQZXJmJyArIHRoaXMubmFtZSk7XG4gIGlmKHRoaXMuZmlyc3QgPT09IDApIHtcbiAgICAgIHRoaXMuZmlyc3QgPSBEYXRlLm5vdygpO1xuICAgICAgdGhpcy5sYXN0ID0gdGhpcy5maXJzdDtcbiAgfSBlbHNlIHtcbiAgICB2YXIgdCA9IERhdGUubm93KCk7XG4gICAgY29ucy5sb2coJ1BlcmYnICsgdGhpcy5uYW1lICtcbiAgICAgJyBkZWx0YTogJyAgKyBTdHJpbmcoXCIgICAgICBcIiArICh0LXRoaXMubGFzdCkpLnNsaWNlKC02KVxuICAgICsnIHRvdGFsOiAnICArIFN0cmluZyhcIiAgICAgIFwiICsgKHQtdGhpcy5maXJzdCkpLnNsaWNlKC02KSk7XG4gICAgdGhpcy5sYXN0ID0gIHQ7XG4gIH1cbiAgaWYodGhpcy5vbltzU3RyaW5nXSkge1xuICAgICBjb25zLnRpbWVFbmQoc1N0cmluZylcbiAgICAgZGVsZXRlIHRoaXMub25bc1N0cmluZ107XG4gIH0gZWxzZSB7XG4gICAgICBjb25zLnRpbWUoc1N0cmluZyk7XG4gICAgICB0aGlzLm9uW3NTdHJpbmddID0gMTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcGVyZihzdHJpbmcpIHtcbiAgcGVyZnNbc3RyaW5nXSA9IHsgbmFtZSA6IHN0cmluZywgbGFzdCA6IDAsIGZpcnN0OiAwLCBvbiA6IHt9LCBlbmFibGVkIDogZmFsc2UgfTtcbiAgaWYgKGRlYnVnKCdwZXJmJyArIHN0cmluZykuZW5hYmxlZCApXG4gIHsgcGVyZnNbc3RyaW5nXS5lbmFibGVkID0gdHJ1ZTtcbiAgfVxuICByZXR1cm4gbG9nUGVyZi5iaW5kKHBlcmZzW3N0cmluZ10sIGNvbnNvbGUpO1xufVxuXG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5cbnZhciBsb2dnZXJzID0ge30gYXMgeyBba2V5OiBzdHJpbmddOiBJTG9nZ2VyIH07XG5cbnZhciBvcyA9IHJlcXVpcmUoJ29zJyk7XG5cbmZ1bmN0aW9uIGdldFdyaXRhYmxlRGlyKCkge1xuICAvLyByZXR1cm4gcHJvY2Vzcy5lbnZbKHByb2Nlc3MucGxhdGZvcm0gPT0gJ3dpbjMyJykgPyAnVVNFUlBST0ZJTEUnIDogJ0hPTUUnXTtcbiAgcmV0dXJuIG9zLnRtcGRpcigpO1xufVxuXG5cbmZ1bmN0aW9uIHNldHVwT25jZSgpIHtcblxuICB2YXIgaG9tZSA9IGdldFdyaXRhYmxlRGlyKCk7XG4gIHRyeSB7XG4gICAgZnMubWtkaXJTeW5jKGhvbWUgKyAnLycgKyAnZmRldnN0YXJ0JyApO1xuICB9IGNhdGNoIChlKSB7XG5cbiAgfVxuICB0cnkge1xuICAgIGZzLm1rZGlyU3luYyhob21lICsgJy9mZGV2c3RhcnQvbG9ncycgKTtcbiAgfSBjYXRjaChlKSB7XG5cbiAgfVxufVxuc2V0dXBPbmNlKCk7XG5cblxuZnVuY3Rpb24gZ2V0RmlsZU5hbWUobmFtZTogc3RyaW5nKSB7XG4gIHJldHVybiBvcy50bXBkaXIoKSAgKyAnL2ZkZXZzdGFydC9sb2dzLycgKyBuYW1lICsgXCIubG9nXCI7XG59XG5cbmV4cG9ydCBjb25zdCBfdGVzdCA9IHtcbiAgZ2V0RmlsZU5hbWU6IGdldEZpbGVOYW1lXG59O1xuXG5mdW5jdGlvbiBsb2dJdChsb2dnZXI6IElMb2dnZXIsIGFyZykge1xuICB2YXIgdGV4dDogc3RyaW5nO1xuICBpZiAodHlwZW9mIGFyZyA9PT0gXCJzdHJpbmdcIikge1xuICAgIHRleHQgPSBhcmc7XG4gIH0gZWxzZSBpZiAoYXJnIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICB0ZXh0ID0gXCJFcnJvcjpcIiArIGFyZy5tZXNzYWdlICsgXCIgXCIgKyBhcmcuc3RhY2s7XG4gIH1cbiAgaWYgKCF0ZXh0KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiSWxsZWdhbCBhcmd1bWVudCB0byBsb2dcIik7XG4gIH1cbiAgdmFyIGZpbGVuYW1lID0gZ2V0RmlsZU5hbWUobG9nZ2VyLm5hbWUpO1xuICB2YXIgZCA9IG5ldyBEYXRlKCk7XG4gIHZhciBuID0gZC50b1VUQ1N0cmluZygpICsgXCJcXHRcIiArIHRleHQ7XG4gIGRlYnVnbG9nKCd3cml0aW5nIGxvZyBlbnRyeSB0byAnICsgZmlsZW5hbWUgKyAnICcgKyBuKTtcbiAgZnMud3JpdGVGaWxlU3luYyhmaWxlbmFtZSwgbiwgeyBlbmNvZGluZzogJ3V0Zi04JywgZmxhZzogJ2EnIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbG9nZ2VyKG5hbWU6IHN0cmluZywgZmxhZ3M/OiBzdHJpbmcpOiAoYW55KSA9PiB2b2lkIHtcbiAgaWYgKGZsYWdzICE9PSAnYScgJiYgZmxhZ3MgIT09ICcnICYmIGZsYWdzICE9PSB1bmRlZmluZWQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ29ubHkgYSBhbGxvd2VkIGFzIGZsYWdzJyk7XG4gIH1cbiAgZmxhZ3MgPSAoZmxhZ3MgPT09IHVuZGVmaW5lZCApPyAgJ2EnIDogZmxhZ3M7XG4gIGlmICh0eXBlb2YgbmFtZSAhPT0gXCJzdHJpbmdcIiB8fCAhL15bQS1aYS16XVtBLVphLXowLTlfXSskLy5leGVjKG5hbWUpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdMb2dnZXIgbmFtZSBtdXN0IGJlIGF0IGxlYXN0IHR3byBhbHBoYW51bWVyaWMgY2hhcmFjdGVycycpXG4gIH1cbiAgaWYgKCFsb2dnZXJzW25hbWVdKSB7XG4gICAgdmFyIGFsb2dnZXIgPSB7XG4gICAgICBuYW1lOiBuYW1lLFxuICAgICAgZmxhZ3M6IGZsYWdzXG4gICAgfSBhcyBJTG9nZ2VyO1xuICAgIGFsb2dnZXIubG9nSXQgPSBsb2dJdC5iaW5kKHVuZGVmaW5lZCwgYWxvZ2dlcik7XG4gICAgLy8gcmVzZXQgdGhlIGZpbGVcbiAgICBpZiAoZmxhZ3MgPT09ICcnKSB7XG4gICAgICB0cnkge1xuICAgICAgICBmcy51bmxpbmtTeW5jKGdldEZpbGVOYW1lKG5hbWUpKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgZGVidWdsb2coXCIqKipFUlJPUjogdW5hYmxlIHRvIHJlbW92ZSBsb2cgZmlsZSBcIiArIGdldEZpbGVOYW1lKG5hbWUpKTtcbiAgICAgIH1cbiAgICB9XG4gICAgbG9nZ2Vyc1tuYW1lXSA9IGFsb2dnZXI7XG4gIH1cbiAgaWYgKGxvZ2dlcnNbbmFtZV0uZmxhZ3MgIT09IGZsYWdzKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdGTGFncyBtaXNtYXRjaCBpbiBsb2dnZXInICsgbmFtZSk7XG4gIH1cbiAgcmV0dXJuIGxvZ2dlcnNbbmFtZV0ubG9nSXQ7XG59Il19
