'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.parse = exports.SelectLexer = exports.parseSentenceToAsts = exports.getLexer = exports.makeToken = void 0;
// based on: http://en.wikibooks.org/wiki/Algorithm_implementation/Strings/Levenshtein_distance
// and:  http://en.wikipedia.org/wiki/Damerau%E2%80%93Levenshtein_distance
const er_index_1 = require("./match/er_index");
const debug = require("debugf");
const SelectParser = require("./parser");
const debuglog = debug('sentenceparser');
const FormatError = require("./formaterror");
const chevrotain = require("chevrotain");
const AST = require("./ast");
var createToken = chevrotain.createToken;
var Lexer = chevrotain.Lexer;
var Parser = chevrotain.Parser;
const index_model_1 = require("./model/index_model");
var WhiteSpace = createToken({ name: "WhiteSpace", pattern: /\s+/ });
WhiteSpace.GROUP = Lexer.SKIPPED;
const tokens_1 = require("./tokens");
// whitespace is normally very common so it is placed first to speed up the lexer
var allTokens = Object.keys(tokens_1.Tokens).map(key => tokens_1.Tokens[key]);
function makeToken(t, index, OL) {
    if (!t.rule) {
        throw new Error("Token without rule " + JSON.stringify(t));
    }
    if (t.rule.wordType === index_model_1.IFModel.WORDTYPE.CATEGORY) {
        return { image: "CAT", startOffset: index, bearer: t, tokenType: tokens_1.OperatorLookup.CAT.tokenType };
    }
    ;
    if (t.rule.wordType === 'F') {
        return { image: "FACT", startOffset: index, bearer: t, tokenType: tokens_1.Tokens.FACT.tokenType };
    }
    if (t.rule.wordType === 'N') {
        //console.log( 'tokentype is ' +  T["Integer"].tokenType  +  ' ' + JSON.stringify( T["Integer"] ));
        // TODO i parses as integer -> integer
        return { image: "NUMBER", startOffset: index, bearer: t, tokenType: tokens_1.Tokens.Integer.tokenType };
    }
    if (t.rule.wordType === 'D') {
        return { image: "DOM", startOffset: index, bearer: t, tokenType: tokens_1.Tokens.DOM.tokenType };
    }
    if (t.rule.wordType === 'A') {
        return { image: "ANY", startOffset: index, bearer: t, tokenType: tokens_1.Tokens.AnANY.tokenType };
    }
    if (t.rule.wordType === 'M') {
        var tlc = t.matchedString.toLowerCase();
        var tlcClean = tlc.replace(/ /g, '_');
        //debulog(">" + tlcClean + "<");
        //debulog(Object.keys(T).indexOf("domain"));
        //debulog(">>>" + JSON.stringify(T["domain"]));
        //debulog("> token >>" + JSON.stringify(T[tlcClean]));
        if (!OL[tlcClean]) {
            //debuglog(Object.keys(T).join('\" \"'));
            throw new Error("unknown token of type M with >" + t.matchedString + "<");
        }
        //debuglog(" here we go" + typeof T["domain"]);
        return { image: t.matchedString, bearer: t, startOffset: index, tokenType: tokens_1.Tokens["domain"].tokenType };
    }
    if (t.rule.wordType === 'O') {
        var tlc = t.matchedString.toLowerCase();
        //var tlcClean = tlc; //  tlc.replace(/ /g,'_');
        var opToken = tokens_1.OperatorLookup[tlc];
        //console.log(' here mapped with _ ' + tlcClean + ' ' + Object.keys(T));
        if (!opToken) {
            debuglog(Object.keys(tokens_1.OperatorLookup).join('\" \"'));
            throw new Error("unknown token of type O with >" + t.matchedString + "< cleansed>" + (tlcClean) + "< not found in " + Object.getOwnPropertyNames(tokens_1.OperatorLookup).join('\n') + " , add to ");
            //process.exit(-1);
        }
        //console.log( ' here image  for O' + t.matchedString + ' ' + T[tlcClean].tokenType);
        return { image: t.matchedString, bearer: t, startOffset: index, tokenType: opToken.tokenType };
    }
    if (t.rule.wordType === 'I') {
        var tlc = t.matchedString.toLowerCase();
        var opToken = tokens_1.Tokens[tlc];
        if (!opToken) {
            debuglog("unknown token of type I with " + t.matchedString);
            process.exit(-1);
        }
        return { image: t.matchedString, bearer: t, startOffset: index, tokenType: opToken.tokenType };
    }
    throw new Error("unknown token " + JSON.stringify(t));
}
exports.makeToken = makeToken;
class XLexer {
    constructor() {
        this.tokenize = function (sentence) {
            debuglog(() => ' sentence prior tokenize:' + JSON.stringify(sentence));
            return sentence.map((t, index) => {
                var u = makeToken(t, index, tokens_1.OperatorLookup);
                debuglog("produced nr   " + index + " > " + JSON.stringify(u));
                return u;
            });
        };
    }
}
;
function getLexer() {
    return new XLexer();
}
exports.getLexer = getLexer;
/* [ AFact, And,
  Describe,
  First, Oldest, Latest, What,
  At, Every, All, At, Least, One,
  The,
  LParen, RParen,


 Meaning, Of, Are,  In, About, You, All,
WhiteSpace, Select, From, Where, Comma, ACategory, All,
  List, Identifier, Integer, GreaterThan, LessThan, To, Relating, With];
*/
var SelectLexer = new Lexer(allTokens);
exports.SelectLexer = SelectLexer;
function parse(tokens, startrule) {
    const parser = new SelectParser.SelectParser(tokens);
    //console.log( ' ' + JSON.stringify( tokens ));
    var res = parser[startrule]();
    if (parser.errors.length > 0) {
        debuglog(() => 'parsing error in  input:' + JSON.stringify(parser.errors, undefined, 2));
        var u = new Error(parser.errors[0]);
        u.error_obj = parser.errors[0];
        throw u;
    }
    return res;
}
exports.parse = parse;
;
function parseSentenceToAsts(s, model, words) {
    var res = er_index_1.ErBase.processString(s, model.rules, words, {} /*model.operators*/);
    debuglog(() => 'res > ' + JSON.stringify(res, undefined, 2));
    var res2 = Object.assign({}, res);
    res2.errors = res2.errors || [];
    res2.asts = res.sentences.map((sentence, index) => {
        res2.errors[index] = false;
        var lexingResult = getLexer().tokenize(sentence);
        debuglog(() => {
            var sStrings = lexingResult.map((t, indext) => `[${indext}] ${t.image} (${t.bearer && t.bearer.matchedString || JSON.stringify(sentence[index][t.startIndex])})`);
            return 'tokens: #' + index + '...\n' + sStrings.join('\n');
        });
        //test.deepEqual(sStrings, ['CAT', 'CAT', 'CAT', 'CAT', 'with', 'CAT', 'FACT', 'CAT', 'FACT', 'FACT' ]);
        try {
            var ast = parse(lexingResult, 'catListOpMore');
            debuglog(() => {
                return 'ast: #' + index + '...\n' + AST.astToText(ast);
            });
            return ast;
        }
        catch (e) {
            debuglog(() => 'error  ' + JSON.stringify(e.error_obj, undefined, 2) + (!e.error_obj ? (e + ' ') + JSON.stringify(e) : ''));
            debuglog(() => ' sentence : ' + er_index_1.Sentence.dumpNice(sentence));
            var e2 = FormatError.formatError(e.error_obj, sentence);
            res2.errors = res2.errors || [];
            debuglog('parse error ' + e.toString());
            res2.errors[index] = {
                err_code: exports.ERR_PARSE_ERROR,
                text: e.toString().split(',\"token\":')[0]
            };
        }
        return undefined;
    });
    return res2;
}
exports.parseSentenceToAsts = parseSentenceToAsts;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zZW50ZW5jZXBhcnNlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUE7OztBQUVaLCtGQUErRjtBQUMvRiwwRUFBMEU7QUFFMUUsK0NBQWdHO0FBRWhHLGdDQUFnQztBQUVoQyx5Q0FBeUM7QUFHekMsTUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDLGdCQUFnQixDQUFDLENBQUM7QUFFekMsNkNBQTZDO0FBQzdDLHlDQUF5QztBQUN6Qyw2QkFBNkI7QUFJM0IsSUFBSSxXQUFXLEdBQUcsVUFBVSxDQUFDLFdBQVcsQ0FBQztBQUN6QyxJQUFJLEtBQUssR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDO0FBQzdCLElBQUksTUFBTSxHQUFHLFVBQVUsQ0FBQyxNQUFNLENBQUM7QUFHakMscURBQXdEO0FBRXRELElBQUksVUFBVSxHQUFHLFdBQVcsQ0FBQyxFQUFDLElBQUksRUFBRSxZQUFZLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBQyxDQUFDLENBQUM7QUFFbkUsVUFBVSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDO0FBRWpDLHFDQUEwRTtBQUMxRSxpRkFBaUY7QUFDakYsSUFBSSxTQUFTLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxlQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxlQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztBQUdwRCxTQUFnQixTQUFTLENBQUMsQ0FBa0IsRUFBRSxLQUFjLEVBQUUsRUFBUTtJQUNwRSxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRTtRQUNYLE1BQU0sSUFBSSxLQUFLLENBQUMscUJBQXFCLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQzVEO0lBQ0QsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsS0FBSyxxQkFBTyxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUU7UUFDakQsT0FB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MUIsSUFBSSxFQUFHLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ3RCLENBQUM7U0FDekI7UUFDRCxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDLENBQUMsQ0FBQztJQUNILE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQWxDRCxrREFrQ0MiLCJmaWxlIjoic2VudGVuY2VwYXJzZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCdcclxuXHJcbi8vIGJhc2VkIG9uOiBodHRwOi8vZW4ud2lraWJvb2tzLm9yZy93aWtpL0FsZ29yaXRobV9pbXBsZW1lbnRhdGlvbi9TdHJpbmdzL0xldmVuc2h0ZWluX2Rpc3RhbmNlXHJcbi8vIGFuZDogIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRGFtZXJhdSVFMiU4MCU5M0xldmVuc2h0ZWluX2Rpc3RhbmNlXHJcblxyXG5pbXBvcnQgeyBFckJhc2UgYXMgRXJCYXNlLCBTZW50ZW5jZSBhcyBTZW50ZW5jZSwgSUZFckJhc2UgYXMgSUZFckJhc2UgfSBmcm9tICcuL21hdGNoL2VyX2luZGV4JztcclxuXHJcbmltcG9ydCAqIGFzIGRlYnVnIGZyb20gJ2RlYnVnZic7XHJcblxyXG5pbXBvcnQgKiBhcyBTZWxlY3RQYXJzZXIgZnJvbSAnLi9wYXJzZXInO1xyXG5cclxuXHJcbmNvbnN0IGRlYnVnbG9nID0gZGVidWcoJ3NlbnRlbmNlcGFyc2VyJyk7XHJcblxyXG5pbXBvcnQgKiBhcyBGb3JtYXRFcnJvciBmcm9tICcuL2Zvcm1hdGVycm9yJztcclxuaW1wb3J0ICogYXMgY2hldnJvdGFpbiBmcm9tICdjaGV2cm90YWluJztcclxuaW1wb3J0ICogYXMgQVNUIGZyb20gJy4vYXN0JztcclxuXHJcbmltcG9ydCB7IEFTVE5vZGVUeXBlIGFzIE5UfSBmcm9tICcuL2FzdCc7XHJcblxyXG4gIHZhciBjcmVhdGVUb2tlbiA9IGNoZXZyb3RhaW4uY3JlYXRlVG9rZW47XHJcbiAgdmFyIExleGVyID0gY2hldnJvdGFpbi5MZXhlcjtcclxuICB2YXIgUGFyc2VyID0gY2hldnJvdGFpbi5QYXJzZXI7XHJcblxyXG5cclxuaW1wb3J0IHsgSUZNb2RlbCBhcyBJRk1vZGVsfSBmcm9tICcuL21vZGVsL2luZGV4X21vZGVsJztcclxuXHJcbiAgdmFyIFdoaXRlU3BhY2UgPSBjcmVhdGVUb2tlbih7bmFtZTogXCJXaGl0ZVNwYWNlXCIsIHBhdHRlcm46IC9cXHMrL30pO1xyXG5cclxuICBXaGl0ZVNwYWNlLkdST1VQID0gTGV4ZXIuU0tJUFBFRDtcclxuXHJcbiAgaW1wb3J0IHsgT3BlcmF0b3JMb29rdXAgYXMgT3BlcmF0b3JMb29rdXAsIFRva2VucyBhcyBUIH0gIGZyb20gJy4vdG9rZW5zJztcclxuICAvLyB3aGl0ZXNwYWNlIGlzIG5vcm1hbGx5IHZlcnkgY29tbW9uIHNvIGl0IGlzIHBsYWNlZCBmaXJzdCB0byBzcGVlZCB1cCB0aGUgbGV4ZXJcclxuICB2YXIgYWxsVG9rZW5zID0gT2JqZWN0LmtleXMoVCkubWFwKGtleSA9PiBUW2tleV0pO1xyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBtYWtlVG9rZW4odCA6IElGRXJCYXNlLklXb3JkLCBpbmRleCA6IG51bWJlciwgT0wgOiBhbnkgKSB7XHJcbiAgaWYgKCF0LnJ1bGUpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIlRva2VuIHdpdGhvdXQgcnVsZSBcIiArIEpTT04uc3RyaW5naWZ5KHQpKTtcclxuICB9XHJcbiAgaWYgKHQucnVsZS53b3JkVHlwZSA9PT0gSUZNb2RlbC5XT1JEVFlQRS5DQVRFR09SWSkge1xyXG4gICAgcmV0dXJuIHsgaW1hZ2UgOiBcIkNBVFwiLCAgc3RhcnRPZmZzZXQgOiBpbmRleCwgYmVhcmVyIDogdCwgdG9rZW5UeXBlIDogT3BlcmF0b3JMb29rdXAuQ0FULnRva2VuVHlwZSB9O1xyXG4gIH07XHJcbiAgaWYgKHQucnVsZS53b3JkVHlwZSA9PT0gJ0YnKSB7XHJcbiAgICByZXR1cm4geyBpbWFnZSA6IFwiRkFDVFwiLCAgc3RhcnRPZmZzZXQgOiBpbmRleCwgYmVhcmVyIDogdCwgdG9rZW5UeXBlIDogVC5GQUNULnRva2VuVHlwZSB9O1xyXG4gIH1cclxuICBpZiAodC5ydWxlLndvcmRUeXBlID09PSAnTicpIHtcclxuICAgIC8vY29uc29sZS5sb2coICd0b2tlbnR5cGUgaXMgJyArICBUW1wiSW50ZWdlclwiXS50b2tlblR5cGUgICsgICcgJyArIEpTT04uc3RyaW5naWZ5KCBUW1wiSW50ZWdlclwiXSApKTtcclxuICAgIC8vIFRPRE8gaSBwYXJzZXMgYXMgaW50ZWdlciAtPiBpbnRlZ2VyXHJcbiAgICByZXR1cm4geyBpbWFnZSA6IFwiTlVNQkVSXCIsICBzdGFydE9mZnNldCA6IGluZGV4LCBiZWFyZXIgOiB0LCB0b2tlblR5cGUgOiBULkludGVnZXIudG9rZW5UeXBlIH07XHJcbiAgfVxyXG4gIGlmICh0LnJ1bGUud29yZFR5cGUgPT09ICdEJykge1xyXG4gICAgcmV0dXJuIHsgaW1hZ2UgOiBcIkRPTVwiLCAgc3RhcnRPZmZzZXQgOiBpbmRleCwgYmVhcmVyIDogdCwgdG9rZW5UeXBlIDogVC5ET00udG9rZW5UeXBlIH07XHJcbiAgfVxyXG4gIGlmICh0LnJ1bGUud29yZFR5cGUgPT09ICdBJykge1xyXG4gICAgcmV0dXJuIHsgaW1hZ2UgOiBcIkFOWVwiLCAgc3RhcnRPZmZzZXQgOiBpbmRleCwgYmVhcmVyIDogdCwgdG9rZW5UeXBlIDogVC5BbkFOWS50b2tlblR5cGUgfTtcclxuICB9XHJcbiAgaWYgKHQucnVsZS53b3JkVHlwZSA9PT0gJ00nKSB7XHJcbiAgICB2YXIgdGxjID0gdC5tYXRjaGVkU3RyaW5nLnRvTG93ZXJDYXNlKCk7XHJcbiAgICB2YXIgdGxjQ2xlYW4gPSB0bGMucmVwbGFjZSgvIC9nLCdfJyk7XHJcbiAgICAvL2RlYnVsb2coXCI+XCIgKyB0bGNDbGVhbiArIFwiPFwiKTtcclxuICAgIC8vZGVidWxvZyhPYmplY3Qua2V5cyhUKS5pbmRleE9mKFwiZG9tYWluXCIpKTtcclxuICAgIC8vZGVidWxvZyhcIj4+PlwiICsgSlNPTi5zdHJpbmdpZnkoVFtcImRvbWFpblwiXSkpO1xyXG4gICAgLy9kZWJ1bG9nKFwiPiB0b2tlbiA+PlwiICsgSlNPTi5zdHJpbmdpZnkoVFt0bGNDbGVhbl0pKTtcclxuICAgIGlmICghT0xbdGxjQ2xlYW5dKSB7XHJcbiAgICAgIC8vZGVidWdsb2coT2JqZWN0LmtleXMoVCkuam9pbignXFxcIiBcXFwiJykpO1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ1bmtub3duIHRva2VuIG9mIHR5cGUgTSB3aXRoID5cIiArIHQubWF0Y2hlZFN0cmluZysgXCI8XCIpO1xyXG4gICAgfVxyXG4gICAgLy9kZWJ1Z2xvZyhcIiBoZXJlIHdlIGdvXCIgKyB0eXBlb2YgVFtcImRvbWFpblwiXSk7XHJcbiAgICByZXR1cm4geyBpbWFnZSA6IHQubWF0Y2hlZFN0cmluZywgYmVhcmVyIDogdCwgc3RhcnRPZmZzZXQgOiBpbmRleCwgdG9rZW5UeXBlIDogVFtcImRvbWFpblwiXS50b2tlblR5cGUgfTtcclxuICB9XHJcbiAgaWYgKHQucnVsZS53b3JkVHlwZSA9PT0gJ08nKSB7XHJcbiAgICB2YXIgdGxjID0gdC5tYXRjaGVkU3RyaW5nLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAvL3ZhciB0bGNDbGVhbiA9IHRsYzsgLy8gIHRsYy5yZXBsYWNlKC8gL2csJ18nKTtcclxuICAgIHZhciBvcFRva2VuID0gT3BlcmF0b3JMb29rdXBbdGxjXTtcclxuICAgIC8vY29uc29sZS5sb2coJyBoZXJlIG1hcHBlZCB3aXRoIF8gJyArIHRsY0NsZWFuICsgJyAnICsgT2JqZWN0LmtleXMoVCkpO1xyXG4gICAgaWYgKCFvcFRva2VuKSB7XHJcbiAgICAgIGRlYnVnbG9nKE9iamVjdC5rZXlzKE9wZXJhdG9yTG9va3VwKS5qb2luKCdcXFwiIFxcXCInKSk7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihcInVua25vd24gdG9rZW4gb2YgdHlwZSBPIHdpdGggPlwiICsgdC5tYXRjaGVkU3RyaW5nICsgXCI8IGNsZWFuc2VkPlwiICsgKHRsY0NsZWFuKSArIFwiPCBub3QgZm91bmQgaW4gXCIgKyBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhPcGVyYXRvckxvb2t1cCkuam9pbignXFxuJykgK1wiICwgYWRkIHRvIFwiKTtcclxuICAgICAgLy9wcm9jZXNzLmV4aXQoLTEpO1xyXG4gICAgfVxyXG4gICAgLy9jb25zb2xlLmxvZyggJyBoZXJlIGltYWdlICBmb3IgTycgKyB0Lm1hdGNoZWRTdHJpbmcgKyAnICcgKyBUW3RsY0NsZWFuXS50b2tlblR5cGUpO1xyXG4gICAgcmV0dXJuIHsgaW1hZ2UgOiB0Lm1hdGNoZWRTdHJpbmcsIGJlYXJlciA6IHQsIHN0YXJ0T2Zmc2V0IDogaW5kZXgsIHRva2VuVHlwZSA6IG9wVG9rZW4udG9rZW5UeXBlIH07XHJcbiAgfVxyXG4gIGlmICh0LnJ1bGUud29yZFR5cGUgPT09ICdJJykge1xyXG4gICAgdmFyIHRsYyA9IHQubWF0Y2hlZFN0cmluZy50b0xvd2VyQ2FzZSgpO1xyXG4gICAgdmFyIG9wVG9rZW4gPSBUW3RsY107XHJcbiAgICBpZiAoIW9wVG9rZW4pIHtcclxuICAgICAgZGVidWdsb2coXCJ1bmtub3duIHRva2VuIG9mIHR5cGUgSSB3aXRoIFwiICsgdC5tYXRjaGVkU3RyaW5nKTtcclxuICAgICAgcHJvY2Vzcy5leGl0KC0xKTtcclxuICAgIH1cclxuICAgIHJldHVybiB7IGltYWdlIDogdC5tYXRjaGVkU3RyaW5nLCBiZWFyZXIgOiB0LCBzdGFydE9mZnNldCA6IGluZGV4LCB0b2tlblR5cGUgOiBvcFRva2VuLnRva2VuVHlwZSB9O1xyXG4gIH1cclxuICB0aHJvdyBuZXcgRXJyb3IoXCJ1bmtub3duIHRva2VuIFwiICsgSlNPTi5zdHJpbmdpZnkodCkpO1xyXG59XHJcblxyXG5jbGFzcyBYTGV4ZXIge1xyXG4gICB0b2tlbml6ZSA9IGZ1bmN0aW9uKHNlbnRlbmNlIDogSUZFckJhc2UuSVNlbnRlbmNlKSA6IGFueVtdICB7XHJcbiAgICBkZWJ1Z2xvZyggKCk9PiAnIHNlbnRlbmNlIHByaW9yIHRva2VuaXplOicgKyBKU09OLnN0cmluZ2lmeShzZW50ZW5jZSkpO1xyXG4gICAgcmV0dXJuIHNlbnRlbmNlLm1hcCggKHQsaW5kZXgpID0+IHtcclxuICAgICAgICAgdmFyIHUgPSAgbWFrZVRva2VuKHQsIGluZGV4LCBPcGVyYXRvckxvb2t1cCk7XHJcbiAgICAgICAgZGVidWdsb2coXCJwcm9kdWNlZCBuciAgIFwiICsgaW5kZXggKyBcIiA+IFwiICsgSlNPTi5zdHJpbmdpZnkodSkpO1xyXG4gICAgICAgIHJldHVybiB1O1xyXG4gICAgfSk7XHJcbiAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldExleGVyKCkgIDogYW55IHtcclxuICByZXR1cm4gbmV3IFhMZXhlcigpO1xyXG59XHJcblxyXG4gIC8qIFsgQUZhY3QsIEFuZCxcclxuICAgIERlc2NyaWJlLFxyXG4gICAgRmlyc3QsIE9sZGVzdCwgTGF0ZXN0LCBXaGF0LFxyXG4gICAgQXQsIEV2ZXJ5LCBBbGwsIEF0LCBMZWFzdCwgT25lLFxyXG4gICAgVGhlLFxyXG4gICAgTFBhcmVuLCBSUGFyZW4sXHJcblxyXG5cclxuICAgTWVhbmluZywgT2YsIEFyZSwgIEluLCBBYm91dCwgWW91LCBBbGwsXHJcbiAgV2hpdGVTcGFjZSwgU2VsZWN0LCBGcm9tLCBXaGVyZSwgQ29tbWEsIEFDYXRlZ29yeSwgQWxsLFxyXG4gICAgTGlzdCwgSWRlbnRpZmllciwgSW50ZWdlciwgR3JlYXRlclRoYW4sIExlc3NUaGFuLCBUbywgUmVsYXRpbmcsIFdpdGhdO1xyXG4qL1xyXG4gICAgdmFyIFNlbGVjdExleGVyID0gbmV3IExleGVyKGFsbFRva2Vucyk7XHJcblxyXG5cclxuZnVuY3Rpb24gcGFyc2UodG9rZW5zIDogYW55W10sIHN0YXJ0cnVsZSA6IHN0cmluZykge1xyXG4gIGNvbnN0IHBhcnNlciA9IG5ldyBTZWxlY3RQYXJzZXIuU2VsZWN0UGFyc2VyKHRva2Vucyk7XHJcbiAgLy9jb25zb2xlLmxvZyggJyAnICsgSlNPTi5zdHJpbmdpZnkoIHRva2VucyApKTtcclxuICB2YXIgcmVzID0gcGFyc2VyW3N0YXJ0cnVsZV0oKTtcclxuICAgaWYgKHBhcnNlci5lcnJvcnMubGVuZ3RoID4gMCkge1xyXG4gICAgZGVidWdsb2coKCkgPT4gJ3BhcnNpbmcgZXJyb3IgaW4gIGlucHV0OicgKyBKU09OLnN0cmluZ2lmeShwYXJzZXIuZXJyb3JzLHVuZGVmaW5lZCwyKSk7XHJcbiAgICB2YXIgdSA9IG5ldyBFcnJvcihwYXJzZXIuZXJyb3JzWzBdKTtcclxuICAgICh1IGFzIGFueSkuZXJyb3Jfb2JqID0gcGFyc2VyLmVycm9yc1swXTtcclxuICAgIHRocm93IHU7XHJcbiAgfVxyXG4gIHJldHVybiByZXM7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSVBhcnNlZFNlbnRlbmNlcyAgZXh0ZW5kcyBJRk1vZGVsLklQcm9jZXNzZWRTZW50ZW5jZXMge1xyXG4gIGFzdHMgOiBBU1QuQVNUTm9kZVtdLFxyXG4gIGRvbWFpbnM/IDogc3RyaW5nW11cclxufTtcclxuXHJcbmV4cG9ydCBkZWNsYXJlIGNvbnN0IEVSUl9QQVJTRV9FUlJPUiA9IFwiUEFSU0VfRVJST1JcIjtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBwYXJzZVNlbnRlbmNlVG9Bc3RzKHMgOiBzdHJpbmcsIG1vZGVsIDogSUZNb2RlbC5JTW9kZWxzLCB3b3JkcyA6IGFueSkgOiBJUGFyc2VkU2VudGVuY2VzIHtcclxuICB2YXIgcmVzID0gRXJCYXNlLnByb2Nlc3NTdHJpbmcocywgbW9kZWwucnVsZXMsIHdvcmRzLCB7fSAvKm1vZGVsLm9wZXJhdG9ycyovICk7XHJcbiAgZGVidWdsb2coKCkgPT4ncmVzID4gJyArIEpTT04uc3RyaW5naWZ5KHJlcywgdW5kZWZpbmVkLCAyKSk7XHJcbiAgdmFyIHJlczIgPSBPYmplY3QuYXNzaWduKHt9LCByZXMgYXMgYW55KSBhcyBJUGFyc2VkU2VudGVuY2VzO1xyXG4gIHJlczIuZXJyb3JzID0gcmVzMi5lcnJvcnMgfHwgW107XHJcbiAgcmVzMi5hc3RzID0gcmVzLnNlbnRlbmNlcy5tYXAoKHNlbnRlbmNlLCBpbmRleCkgPT4ge1xyXG4gICAgcmVzMi5lcnJvcnNbaW5kZXhdID0gZmFsc2U7XHJcbiAgICB2YXIgbGV4aW5nUmVzdWx0ID0gZ2V0TGV4ZXIoKS50b2tlbml6ZShzZW50ZW5jZSk7XHJcbiAgICBkZWJ1Z2xvZyggKCkgPT4ge1xyXG4gICAgICB2YXIgc1N0cmluZ3MgPSBsZXhpbmdSZXN1bHQubWFwKCh0LCBpbmRleHQpID0+ICBgWyR7aW5kZXh0fV0gJHt0LmltYWdlfSAoJHt0LmJlYXJlciAmJiB0LmJlYXJlci5tYXRjaGVkU3RyaW5nIHx8IEpTT04uc3RyaW5naWZ5KHNlbnRlbmNlW2luZGV4XVt0LnN0YXJ0SW5kZXhdKX0pYCApO1xyXG4gICAgICByZXR1cm4gJ3Rva2VuczogIycgKyBpbmRleCArICcuLi5cXG4nICsgc1N0cmluZ3Muam9pbignXFxuJyk7XHJcbiAgICB9KTtcclxuICAgIC8vdGVzdC5kZWVwRXF1YWwoc1N0cmluZ3MsIFsnQ0FUJywgJ0NBVCcsICdDQVQnLCAnQ0FUJywgJ3dpdGgnLCAnQ0FUJywgJ0ZBQ1QnLCAnQ0FUJywgJ0ZBQ1QnLCAnRkFDVCcgXSk7XHJcbiAgICB0cnkge1xyXG4gICAgICB2YXIgYXN0ID0gcGFyc2UobGV4aW5nUmVzdWx0LCAnY2F0TGlzdE9wTW9yZScpO1xyXG4gICAgICBkZWJ1Z2xvZygoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuICdhc3Q6ICMnICsgaW5kZXggKyAnLi4uXFxuJyArIEFTVC5hc3RUb1RleHQoYXN0KTtcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBhc3Q7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGRlYnVnbG9nKCgpPT4gJ2Vycm9yICAnICsgSlNPTi5zdHJpbmdpZnkoZS5lcnJvcl9vYmosdW5kZWZpbmVkLDIpICsgKCFlLmVycm9yX29iaj8gKGUgKyAnICcpICsgSlNPTi5zdHJpbmdpZnkoZSk6ICcnKSk7XHJcbiAgICAgIGRlYnVnbG9nKCgpPT4gJyBzZW50ZW5jZSA6ICcgKyBTZW50ZW5jZS5kdW1wTmljZShzZW50ZW5jZSkpO1xyXG4gICAgICB2YXIgZTIgPSBGb3JtYXRFcnJvci5mb3JtYXRFcnJvcihlLmVycm9yX29iaixzZW50ZW5jZSk7XHJcbiAgICAgIHJlczIuZXJyb3JzID0gcmVzMi5lcnJvcnMgfHwgW107XHJcbiAgICAgIGRlYnVnbG9nKCdwYXJzZSBlcnJvciAnICsgZS50b1N0cmluZygpKTtcclxuXHJcbiAgICAgIHJlczIuZXJyb3JzW2luZGV4XSA9IHtcclxuICAgICAgICBlcnJfY29kZSA6IEVSUl9QQVJTRV9FUlJPUixcclxuICAgICAgICB0ZXh0IDogZS50b1N0cmluZygpLnNwbGl0KCcsXFxcInRva2VuXFxcIjonKVswXVxyXG4gICAgICB9ICBhcyBJRkVyQmFzZS5JRVJFcnJvcjtcclxuICAgIH1cclxuICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgfSk7XHJcbiAgcmV0dXJuIHJlczI7XHJcbn1cclxuLy9cclxuZXhwb3J0IHtcclxuICAgU2VsZWN0TGV4ZXIsXHJcbiAgIHBhcnNlXHJcbiAgIC8vIGRlZmF1bHRSdWxlIDogXCJzZWxlY3RTdGF0ZW1lbnRcIlxyXG59O1xyXG4iXX0=
